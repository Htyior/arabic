from dataclasses import replace
from telegram import *
from telegram.ext import *
import sqlite3
import os
import random
from time import sleep
from collections import Counter


from ..Buttons.button import btn
from ..DataBase.database_handler import database

button = btn
data = database()

current_path = os.getcwd()


class msg:
    def __init__(self) -> None:
        self.last_msg_right = ""
        self.last_msg_wrong = ""

    def welcomeMsg(update: Update, context: CallbackContext):

        data.botStart(update, context)

        context.bot.send_chat_action(chat_id=update.effective_chat.id, action=ChatAction.TYPING)

        sleep(1.5)

        update.message.reply_text(f"""ุณูุงู {update.effective_user.first_name} ๐ค
ฺุทูุฑุ ๐
ูู ุฑุจุงุช ูุณุชู ฺฉู ฺฉูฺฉุช ูโฺฉูู ุนุฑุจ (ููุฌู ูุจูุงู) ุฎูุฏุช ุฑู ูุญฺฉ ุจุฒู ู ุจุจู ุณุทุญ ุนุฑุจุช ุฏุฑ ฺู ุญุฏ ูุณุช. ๐ฒ
ุญุช ุจูุช ูฺฏู ุฏููุงู ฺฉุฌุง ูุง ุถุนู ุฏุงุฑ ู ฺฉูฺฉุช ูโฺฉูู ุงูู ุถุนู ูุง ุฑู ุฑู ุจุฑุทุฑู ฺฉู.๐ฆ
ุจูุช ููู ูุฏู ุงฺฏู ุชุง ุขุฎุฑ ุจุง ูู ููุฑุงู ุจุงุด ุนุฑุจุช ฺฉู ูู ุชุฑ ูุดู ู ุนูุฑุง ุชู ุตุญุจุช ฺฉุฑุฏู ฺฉู ููุงุฑ.๐๐""")

        context.bot.send_chat_action(chat_id=update.effective_chat.id, action=ChatAction.TYPING)

        sleep(8)

        update.message.reply_text("๐")

        context.bot.send_chat_action(chat_id=update.effective_chat.id, action=ChatAction.TYPING)


        sleep(3)

        update.message.reply_text("""
        ุญุงูุง ูุฑุงุฑู ฺุทูุฑ ุงู ฺฉุงุฑ ุฑู ุงูุฌุงู ุจุฏูุุ๐ค
ุฎู ุณุงุฏู ...

ูู ุงูุงู ู ุงูุชุญุงู ุชุณุช ุงุฒุช ูฺฏุฑู ฺฉู ฑต ุฏููู ูู ููุชุช ุฑู ููฺฏุฑูุ ุงู ุงูุชุญุงู ุดุงูู ุฎู ุงุฒ ูุจุงุญุซ ููู ูุดู ฺฉู ุญุชูุง ุจุงุฏ ุจูุฏ ุจุงุด. ุชููุง ฺฉุงุฑ ฺฉู ุจุงุฏ ุงูุฌุงู ุจุฏ ุงูู ฺฉู ุฏฺฉูู ุดุฑูุน ุฑู ุจุฒู ู ุงูุชุญุงู ุฑู ุดุฑูุน ฺฉู.
ุฎูุฏู ุขุฎุฑุด ุจูุช ููุฑู ูุฏู ู ุจูุช ูฺฏู ฺฉู ุงุดฺฉุงูุงุชุช ฺฉุฌุง ุจูุฏ ู ุฑู ฺฉุฏูู ูุจุงุญุซ ุจุดุชุฑ ุจุงุฏ ฺฉุงุฑ ฺฉู.๐๐ช๐ป""")

        sleep(12)

        update.message.reply_text("""โผ๏ธุญูุงุณุช ุจุงุดู ููุท ู ุจุงุฑ ุจุดุชุฑ ููุชูู ุงูุชุญุงู ุจุฏุ ูพุณ ุณุน ฺฉู ูุดุดุดุดูฺฏ ุชูุฑฺฉุฒ ฺฉู๐คญ""")

        sleep(1)

        button.start_quiz(update, context)


# -----------------------------------------------------------------------------------------
    
    def send_message_to_all(self, update: Update, context: CallbackContext):
        if update.effective_user.id == 1331350150:
            user_id_list =  data.send_msg_to_all(update, context)
            message = data.message_to_all_users(update, context)

            for i in range(user_id_list[0]):
                context.bot.send_message(chat_id=user_id_list[1][i], text=message)

        else:
            pass

    def response(self, update: Update, context: CallbackContext):
        # if user finished the exam, dont allow him to play
        
        if data.check_level(update, context) == 41: 
            update.message.reply_text("""ุงูุชุญุงู ุชููู ุดุฏ๐\nฺฉ ุฏููู ุตุจุฑ ฺฉู ุชุง ูุชุฌู ุฑู ูุญุงุณุจู ฺฉูู ู ุจุฑุงุช ุจูุฑุณุชู๐""")

            sleep(5)

            score = data.calc_score(update, context)
            right = score
            wrong = 40 - right
            final = (right / 40) * 100

            context.bot.send_chat_action(chat_id=update.effective_chat.id, action=ChatAction.TYPING)

            sleep(5)

            update.message.reply_text(f"""ูุชุฌู ุงูุชุญุงูุช ุขูุงุฏู ุดุฏ.""")

            sleep(2)

            update.message.reply_text(f"""
            โ ุชุนุฏุงุฏ ุฌูุงุจ ูุง ุฏุฑุณุช: {right}\n\nโุชุนุฏุงุฏ ุฌูุงุจ ูุง ุบูุท: {wrong}\n\n๐ปููุฑู ุงุฒ 100: {final}""")

            sleep(2)

            if final == 100:
                context.bot.send_chat_action(chat_id=update.effective_chat.id, action=ChatAction.TYPING)
                sleep(10)
                update.message.reply_text("""ุจุงุจุง ฺฉุงุฑุช ุฏุฑุณุชู ๐คฏ๐คฏ
ููุฌู ูุจูุงู ุช ุนุงู ูุณุช ู ูุดุฎุตู ูโุฏูู ุฏุงุฑ ฺฺฉุงุฑ ูโฺฉู.
ุณูุงูุงุช ุงุฒ ููุถูุนุงุช ูุฎุชูู ุจูุฏุ ูู ุชู ููุด ุฑู ุฏุฑุณุช ุฌูุงุจ ุฏุงุฏ. ุงู ุนู ูุจูุง ุจุง ููู ุงู ูุง ููุงุฌู ุดุฏ ู ุฑูุดูู ฺฉุงุฑ ฺฉุฑุฏ.๐๐
ูู ุญูุงุณุช ุจุงุดู ุจู ุฎูุฏุช ูุบุฑูุฑ ูุด ุงุตูุงุงุงุ ูุญุธู ุง ฺฉู ุจู ุฎูุฏุช ูุบุฑูุฑ ุจุด ุฏููุงู ูููู ูุญุธู ุงู ฺฉู ุฏฺฏู ูพุดุฑูุช ููโฺฉู.
ูุทูุฆูุงู ูููุฒ ุฎู ฺุฒ ูุง ูุณุช ฺฉู ุจุงุฏ ุงุฏ ุจฺฏุฑ.
ุงฺฏู ุฎูุฏุชู ุงู ุงุญุณุงุณ ุฑู ุฏุงุฑ ุจุง ูู ููุฑุงู ุดู
ุชุง ูุทุงูุจ ุฏฺฏู ุฑู ูู ุจุง ูู ฺฉุงุฑ ฺฉูู""")


            if 100 > final > 70:
                test = data.read_lessons(update, context)
                test = test.split(", ")
                testi = Counter(test)
                s = "\nโ๏ธ".join(testi.keys())
                s = s.replace('None', '')
                s = "๐ฐ ุงู ูุง ููุงุฑุฏ ูุณุช ฺฉู ุชู ุฏุฑุดูู ุถุนู ุฏุงุฑ ู ุจุงุฏ ุจุดุชุฑ ุฑู ุงูู ูุง ฺฉุงุฑ ฺฉู:\n" + s 
                update.message.reply_text(s)

                context.bot.send_chat_action(chat_id=update.effective_chat.id, action=ChatAction.TYPING)
                sleep(10)
                update.message.reply_text("""ุจูุช ุชุจุฑฺฉ ูฺฏู๐ฅณ๐ฅณ
ููุฌู ูุจูุงู ุช ุชู ุณุทุญ ุฎูุจ ูุณุช ู ูุดุฎุตู ฺฉู ุฑู ุฎู ุงุฒ ูุจุงุญุซ ฺฉุงุฑ ฺฉุฑุฏ ู ูโุฏูู ฺ ุจู ฺู.๐
ูู ุฎุจ ุจุงุฒ ูู ุถุนู ูุง ุฏุงุดุช ฺฉู ูู ูุชููู ูุงุณู ุชููุชุดูู ฺฉูฺฉุช ฺฉูู๐
ุญูุงุณุช ุจุงุดู ูููุชุฑู ูุณูุช ุงูุชุญุงู ุฏุงุฏูุ ูพุฏุง ฺฉุฑุฏู ููุงุท ุถุนูุช ู ุจุฑุทุฑู ฺฉุฑุฏูุดููู
 ฺฉู ุฎู ุฑุงุญุช ุจุง ุฎููุฏู ุฏุฑุณูุงูู ูุง ุ ูุชูู ููุฌุช ุฑู ุชููุช ฺฉู..
ู ูููฺฉู ูุทุงูุจ ุจุดุชุฑ ูุณุช ฺฉู ูุชููู ุชู ุฑู ุจู ุณุทุญ ุจุงูุงุชุฑ ุจุฑุณููู..""")

            if 70 > final > 40:
                test = data.read_lessons(update, context)
                test = test.split(", ")
                testi = Counter(test)
                s = "\nโ๏ธ".join(testi.keys())
                s = s.replace('None', '')
                s = "๐ฐ ุงู ูุง ููุงุฑุฏ ูุณุช ฺฉู ุชู ุฏุฑุดูู ุถุนู ุฏุงุฑ ู ุจุงุฏ ุจุดุชุฑ ุฑู ุงูู ูุง ฺฉุงุฑ ฺฉู:\n" + s 
                update.message.reply_text(s)

                context.bot.send_chat_action(chat_id=update.effective_chat.id, action=ChatAction.TYPING)
                sleep(10)
                update.message.reply_text("""โโโโโ
ุขูุฑูุ ุฎู ุงูุชุญุงู ุฎูุจ ุฏุงุฏ๐๐
ููุฑู ุช ุฎูุจูุ ุงู ูุดูู ูุฏู ุฎูุจ ุฏุงุฑ ูุฑ ุฌูู ู ูุจุงุญุซ ุฑู ุงุฏ ูโฺฏุฑุ ุงู ุงูุชุญุงู ุงุฒ ููุถูุนุงุช ูุฎุชูู ุจูุฏุ ูู ุชู ุชููุณุช ุจุดุชุฑุด ุฑู ุฏุฑุณุช ุฌูุงุจ ุจุฏ. ุงู ุนุงูู๐ค
ูู ุฎูุฏุช ุจูุชุฑ ูโุฏูู ฺฉู ูุงุฒ ุจู ฺฉุงุฑ ฺฉุฑุฏู ุฏุงุฑ ู ุจุงุฏ ุจุดุชุฑ ููุฌู ูุจูุงู ุฑู ุชูุฑู ฺฉู.
ูู ุฎุจุฑ ุฎูุจ ุงูุญุงุณุช ฺฉู ููุฎูุงุฏ ุฌุง ุฏูุฑ ุจุฑุ ูู ุฏุฑุณูุงูู ูุง ุงู ุณูุงูุงุฑู ุจูุช ุงุฏ ูุฏูุ ุจุง ฺฉู ูุทูุจ ุฏฺฏู ฺฉู ุชูุฑู ุจู ุณุทุญ ุจุงูุงุชุฑ ูุจุฑู..""")


            if final < 40:
                test = data.read_lessons(update, context)
                test = test.split(", ")
                testi = Counter(test)
                s = "\nโ๏ธ".join(testi.keys())
                s = s.replace('None', '')
                s = "๐ฐ ุงู ูุง ููุงุฑุฏ ูุณุช ฺฉู ุชู ุฏุฑุดูู ุถุนู ุฏุงุฑ ู ุจุงุฏ ุจุดุชุฑ ุฑู ุงูู ูุง ฺฉุงุฑ ฺฉู:\n" + s 
                update.message.reply_text(s)

                context.bot.send_chat_action(chat_id=update.effective_chat.id, action=ChatAction.TYPING)
                sleep(10)
                update.message.reply_text("""โโโโโ
ุขูุฑูุ ุงูุชุญุงู ุฎูุจ ุฏุงุฏ๐
ุงุฒ ููุฑู ุช ูุดุฎุตู ุชุงุฒู ููุฌู ูุจูุงู ุฑู ุดุฑูุน ฺฉุฑุฏ ู ุงูู ูุณุฑ. ููุฑู ุง ฺฉู ุจู ุฏุณุช ุขูุฑุฏ ูุณุจุช ุจู ูุนูููุงุชุช ุนุงูู. ู ูุทูุฆูู ุจุดุชุฑ ุจูุฏ ูู ูููุฒ ูุงุณุช ุชุซุจุช ูุดุฏู..
ู ูููุฒู ุฎู ฺุฒ ุง ุฏฺฏู ูุณุช ฺฉู ุจุงุฏ ุงุฏ ุจฺฏุฑ.๐๐
ุจุง ุฏูุจุงููุ ุฏุฑุณูุงูู ูุงุฑู ุจุฎูู ู ุงุทูุงุนุงุชุช ุฑู ุชุซุจุช ฺฉูุ ูุงุณู ุชููุช ฺฉุฑุฏู ููุฌุช ููุท ู ูุฏู ุฏฺฏู ุจุฑุฏุงุฑุ ูู ฺฉูฺฉุช ูฺฉูู.๐""")


            context.bot.send_chat_action(chat_id=update.effective_chat.id, action=ChatAction.TYPING)
            sleep(15)


            update.message.reply_text("""ุงูู ู ุฎุงุทุฑู ุจุฑุงุช ุชุนุฑู ฺฉูู ...

ฺูุฏ ููุช ูพุด ู ฺฉุดูุฑ ุนุฑุจ ุจูุฏู. ุจู ูุงุณุทู ฺฉุงุฑ ฺฉู ุฏุงุดุชู ุจุง ุฎู ูุง ุจุงุฏ ุตุญุจุช ูโฺฉุฑุฏู ู ูุชุฑุฌู ูู ูุฏุงุดุชู ฺฉู ฺฉูฺฉู ฺฉููุ ูพุณ ูุฌุจูุฑ ุจูุฏู ุฎูุฏู ฺฏูู ุฎูุฏู ุฑู ุงุฒ ุขุจ ุจฺฉุดู ุจุฑูู ู ุณุน ฺฉุฑุฏู ุจู ุงู ูููุนุช ุจู ุนููุงู ู ูุฑุตุช ุงุฏฺฏุฑ ูฺฏุงู ฺฉููุ ฺฉุงุฑ ฺฉู ุงูุฌุงู ุฏุงุฏู ุงู ุจูุฏ ฺฉู ูุฑ ฺุฒ ุฑู ฺฉู ุจูุฏ ูุจูุฏู ู ุฎู ุจูุด ูุงุฒ ุฏุงุดุชู ุฑู ุงุฏุฏุงุดุช ฺฉูู. ูุซูุง ูููุฏู ฺฉู ูู ุงุตูุงุงุง ุงุนุฏุงุฏ ุฑู ุจูุฏ ูุณุชูุ ูพุณ ุงุฏุฏุงุดุช ูโฺฉุฑุฏู ุจุงุฏ ุงุนุฏุงุฏ ุฑู ุชูุฑู ฺฉูู. (ุจูุงูุฏ ฺฉู ููุด ูฺฏุฑุงู ุจูุฏู ูฺฉูู ููุช ุจูููู ุนุฑุจ ูุณุชู ู ุนุฑุจู ูู ุฎูโุฎูุจ ูุณุช ุณุฑู ฺฉูุงู ุจุฐุงุฑู๐๐)

ููุช ูุฎูุงุณุชู ฺุฒ ุจุฎุฑู ููพุฑุณุฏู ููุช ฺูุฏูุ ูุบุงุฒู ุฏุงุฑ ู ฺุฒ ูฺฏูุช ู ููู ุงูฺฉ ูฺฏูุชู ุงูฺฉ ู ู ูพูู ุฏุฑุดุช ุจูุด ูุฏุงุฏู ฺฉู ูุฎูุงู ูพูู ุฑู ุฎูุฏู ุจุดูุงุฑู ู ููุท ุจูู ูพูู ุฑู ูฺฏุฑูุชู๐๐""")


            context.bot.send_photo(update.effective_chat.id, photo='AgACAgQAAxkBAAEWWhhi3WuZMQbpWtouTdCSuDAbwKZwdgAChbgxGw_e4VIcEWmIiFDZIwEAAwIAA3MAAykE')


            update.message.reply_text("""ููุช ุจุฑฺฏุดุชู ุงุฑุงู ููุท ฺฉ ุณุงุนุช ููุช ฺฏุฐุงุดุชู ู ุงุนุฏุงุฏ ุนุฑุจ ุฑู ุงุฏฺฏุฑูุชูุ ู ุณุน ฺฉุฑุฏู ุชุง ูโุชููู ุงุนุฏุงุฏ ุฑู ุจุง ุฎูุฏู ุชฺฉุฑุงุฑ ฺฉูู.
ูุชุฌู ฺ ุดุฏุ
ุชู ุณูุฑ ุจุนุฏ ุงููุฏุฑ ุงุนุฏุงุฏ ุจุฑุงู ุฑุงุญุช ุจูุฏ ู ุนุงู ุงุฏฺฏุฑูุชู ุจูุฏู ฺฉู ุจูู ูู ุงุฒ ูู ฺฉูฺฉ ูุฎูุงุณุชู ู ุญุช ุฌูุน ู ุชูุฑู ูพูู ูุง ุฑู ุณุฑุน ุชุฑ ุงุฒ ุฎูุฏ ุนุฑุจ ูุง ุงูุฌุงู ูโุฏุงุฏู ๐โ๐ป

ุงุนุฏุงุฏ ููุท ฺฉ ูุซุงู ุจูุฏ ฺฉู ูุชูุฌู ุจุด ฺูุฏุฑ ูููู ฺฉู ุจุชูู ุถุนู ูุง ฺฉู ุฏุงุฑ ุฑู ุดูุงุณุง ฺฉู ู ุงููุง ุฑู ุจู ููุงุท ููุชุช ุชุจุฏู ฺฉู.โ๐ป""")


            sleep(40)


            update.message.reply_text("""ูู ููุทู ุถุนูุง ุฎูุฏูู ุฏูุจุงู ฺฉุฑุฏู ู ุจู ุงู ูุฑุญูู ุฑุณุฏู..

ุงุทูุงุนุงุช ฺฉู ุฎูุฏู ุจูุฏู ุฑู ุฏุฑ ุงุฎุชุงุฑุช ูุฐุงุฑู ฺฉู ุชู ูู ุฑุงุญุช ุจุชูู ุฎูุฏุช ุฑู ุจู ุณุทุญุง ุจุงูุงุชุฑ ุจุฑุณูู..๐

ูฺฉุฑุดู ุจฺฉู ฺูุฏ ูุชูู ุณุฑุนุชุฑ ุถุนูุง ููุฌุช ุฑู ุชููุช ฺฉู ู ุชุงุฒู ฺฉูุงุฑุด ฺฉู ูุทูุจ ุฏฺฏู ูู ุงุฏ ุจฺฏุฑ..๐

ูู ูุงุณุช ู ูุฑุฌุน ูุจูุงู ุณุงุฎุชูุ ฺฉู ูุงุฏุงู ุงูุนูุฑ ุฏุณุชุชู ู ุฑุงุญุช ูุชูู ุจู ูุฑ ุฏุฑุณูุงูู ุง ฺฉู ูุฎูุง ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุด..โ๏ธ

ุงู ฺฉุงู ูุณุชุ!

ูุงุณุช ฺฉูุงุฑุด ุงุตุทูุงุญุงุช ู ฺฉู ฺฉููู ฺฏุฐุงุดุชู ฺฉู ุฏุงุฑู ูุบุงุชุช ูู ุจุฑู ุจุงูุง..๐คฏ

ุฏฺฏู ููุชุธุฑ ฺ ูุณุชุ!
ุฒูุฏุชุฑ ุงุฒ ุจูู ูพุดุฑูุช ฺฉู๐ช๐ปุ ููู ฺฉูุงุฑุชู..๐ฅณ""")









        else:
            if update.message.text == "ุณูุงู ุจุนุฏ":
                button.question_btn(update, context)
                data.question(update, context)

            if update.message.text == "ุดุฑูุน":
                button.question_btn(update, context)
                data.question(update, context)

            if update.message.text == data.right_answer(update, context, condition=True):
                right_messages = [
                    "โุขูุฑูุ ุฏุฑุณุช ุจูุฏ๐๐ปโ",
                    "โุจุฑุงูููููโ๏ธ๐ปโ",
                    "โฺฉุงุฑุช ุฏุฑุณุชู๐ช๐ปโ",
                    "โู ูพุง ุงุณุชุงุฏ ุจุฑุง ุฎูุฏุช๐ค๐ปโ",
                    "โูฺฉูู ู ููุช ุดุงูุณ ุฌูุงุจ ุจุฏ๐โ",
                    "โุฏูุช ฺฏุฑูโ",
                    "โุจุงุจุงุงุงุงุงุ ุฏุณุช ูุงุฑู ูู ุจฺฏุฑ๐โ๏ธโ",
                    "โุขูุฑูโ",
                    "โุขูุฑู . ูุงุณู ุณูุงู ุจุนุฏ ุขูุงุฏู ุงุโ",
                    "โุนุงูู . ูููุทูุฑ ุงุฏุงูู ุจุฏูโ",
                    "โุงุญุณูุช . ุงูู ฺฉู ุฏุฑุณุช ุฌูุงุจ ุฏุงุฏุ ุจุจูู ุชุง ุขุฎุฑ ฺฺฉุงุฑ ูฺฉู!โ",
                    "โููุชุงุฒ . ุฏุงุฑ ุนุงู ูพุด ูุฑโ",
                    "โุฏูุช ฺฏุฑู๐คโ",
                    "โฺฉุงุฑุช ุนุงููุ ุจุง ููู ูุฑููู ุจุฑู ุฌูู๐คโ",
                    "โุฏุงุฑ ุนุงู ูพุด ูุฑ๐โ",
                    "โุฏุงุฑ ูุชุฑฺฉูู๐๐ปโ",
                    "โุญุฑุช ุขูุฑู๐คฉโ",
                    "๐",
                    "๐ฅณ",
                    "๐",
                ]
                # create a random message
                while True:
                    right_message = random.choice(right_messages)
                    if right_message in self.last_msg_right:
                        continue
                    else:
                        self.last_msg_right = right_message
                        update.message.reply_text(right_message)
                        data.level_up(update, context, condition=True) # level up, score up
                        button.main_btn(update, context)
                        data.score_up(update, context)
                        break


            # user send a wrong answer
            if update.message.text in data.wrong_answers(update, context):
                wrong_messages = [
                    "โุญูุงุณุช ฺฉุฌุงุณุชุโ",
                    "โุงุดุชุจุงู ุจูุฏโ",
                    "โุญูุงุณุช ุฑู ุฌูุน ฺฉูโ",
                    "โุงุดุชุจุงู ุฌูุงุจ ุฏุงุฏโ",
                    "โุญูุงุณุช ุฑู ุฌูุน ฺฉู ุฎูุดฺฏููโ",
                    "โุญูุงุณุช ฺฉุฌุงุณุช ุฎูุดฺฏููุโ",
                    "โุจุดุชุฑ ุฏูุช ฺฉู๐โ",
                    "โุงุดุชุจุงู ุจูุฏ๐คท๐ปโโ๏ธโ",
                    "โุงุฒ ุชู ุงูุชุธุงุฑ ุจุดุชุฑ ุฏุงุฑูุง๐โ",
                    "โุงุดุชุจุงู ุฌูุงุจ ุฏุงุฏ ฺฉูุ ุจุง ูุงุณู ุจุนุฏ๐โ"
                ]
                # create a random message
                while True:
                    wrong_message = random.choice(wrong_messages)
                    if wrong_message in self.last_msg_wrong:
                        continue
                    else:
                        self.last_msg_wrong = wrong_message
                        wrong_message = random.choice(wrong_messages)
                        update.message.reply_text(wrong_message)
                        data.level_up(update, context, condition=False) # level up, no change on score
                        data.lessons(update, context)
                        button.main_btn(update, context)
                        break
        
#        if update.message.reply_text in "result":
#            print("result")